<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد مدیریت - صراف</title>
    <link rel="stylesheet" href="/admin/css/admin-style.css">
    <style>
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        @media (max-width: 768px) {
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <h1 class="brand">صراف</h1>
            <p>پنل مدیریت</p>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="overview">
                <span class="icon">📊</span>
                <span>نمای کلی</span>
            </a>
            <a href="#" class="nav-item" data-section="users">
                <span class="icon">👥</span>
                <span>کاربران</span>
            </a>
            <a href="#" class="nav-item" data-section="prizes">
                <span class="icon">🎁</span>
                <span>جوایز</span>
            </a>
            <a href="#" class="nav-item" data-section="daily">
                <span class="icon">📅</span>
                <span>آمار روزانه</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <button id="logoutBtn" class="btn-logout">
                <span class="icon">🚪</span>
                <span>خروج</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="dashboard-header">
            <h2 id="sectionTitle">نمای کلی</h2>
            <div class="header-actions">
                <button id="refreshBtn" class="btn-action">
                    <span class="icon">🔄</span>
                    بروزرسانی
                </button>
                <button id="exportBtn" class="btn-action btn-export">
                    <span class="icon">📥</span>
                    خروجی Excel
                </button>
            </div>
        </header>

        <!-- Overview Section -->
        <section id="overviewSection" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">👤</div>
                    <div class="stat-content">
                        <h3>کل کاربران</h3>
                        <p class="stat-number" id="totalUsers">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">✅</div>
                    <div class="stat-content">
                        <h3>تایید شده</h3>
                        <p class="stat-number" id="verifiedUsers">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">🎰</div>
                    <div class="stat-content">
                        <h3>شرکت کرده</h3>
                        <p class="stat-number" id="playedUsers">0</p>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon">📈</div>
                    <div class="stat-content">
                        <h3>نرخ مشارکت</h3>
                        <p class="stat-number" id="participationRate">0%</p>
                    </div>
                </div>
            </div>

            <!-- Today's Stats -->
            <div class="today-stats">
                <h3>آمار امروز</h3>
                <div class="stats-row">
                    <div class="mini-stat">
                        <span class="label">کاربران جدید:</span>
                        <span class="value" id="todayUsers">0</span>
                    </div>
                    <div class="mini-stat">
                        <span class="label">بازی‌های انجام شده:</span>
                        <span class="value" id="todayPlayed">0</span>
                    </div>
                </div>
            </div>

            <!-- Charts -->
            <div class="charts-container">
                <canvas id="dailyChart"></canvas>
                <canvas id="prizeChart"></canvas>
            </div>
        </section>

        <!-- Users Section -->
        <section id="usersSection" class="section">
            <div class="filters-bar">
                <input
                        type="text"
                        id="searchInput"
                        placeholder="جستجو شماره یا جایزه..."
                        class="search-input"
                >
                <select id="filterSelect" class="filter-select">
                    <option value="all">همه کاربران</option>
                    <option value="played">شرکت کرده‌ها</option>
                    <option value="not_played">شرکت نکرده‌ها</option>
                    <option value="verified">تایید شده‌ها</option>
                </select>
            </div>

            <div class="table-container">
                <table class="users-table">
                    <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>شماره تماس</th>
                        <th>وضعیت تایید</th>
                        <th>شرکت کرده</th>
                        <th>جایزه</th>
                        <th>کد جایزه</th>
                        <th>تاریخ ثبت‌نام</th>
                        <th>تاریخ بازی</th>
                    </tr>
                    </thead>
                    <tbody id="usersTableBody">
                    <!-- Users will be loaded here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
                <!-- Pagination will be loaded here -->
            </div>
        </section>

        <!-- Prizes Section -->
        <section id="prizesSection" class="section">
            <div class="prizes-header">
                <button id="addPrizeBtn" class="btn-action btn-add">
                    <span class="icon">➕</span>
                    افزودن جایزه جدید
                </button>
                <button id="normalizeProbBtn" class="btn-action">
                    <span class="icon">⚖️</span>
                    نرمال‌سازی احتمالات
                </button>
                <div class="prob-sum">
                    مجموع احتمالات: <span id="totalProbability">0</span>
                </div>
            </div>

            <div class="prizes-stats">
                <table class="prizes-table">
                    <thead>
                    <tr>
                        <th>نام جایزه</th>
                        <th>احتمال برد</th>
                        <th>تعداد برنده</th>
                        <th>درصد واقعی</th>
                        <th>وضعیت</th>
                        <th>عملیات</th>
                    </tr>
                    </thead>
                    <tbody id="prizesTableBody">
                    <!-- Prizes will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Daily Stats Section -->
        <section id="dailySection" class="section">
            <div class="daily-stats-container">
                <div class="period-selector">
                    <button class="period-btn active" data-days="7">7 روز</button>
                    <button class="period-btn" data-days="30">30 روز</button>
                    <button class="period-btn" data-days="90">90 روز</button>
                </div>

                <table class="daily-table">
                    <thead>
                    <tr>
                        <th>تاریخ</th>
                        <th>کاربران جدید</th>
                        <th>تعداد بازی</th>
                        <th>نرخ مشارکت</th>
                    </tr>
                    </thead>
                    <tbody id="dailyTableBody">
                    <!-- Daily stats will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>
</div>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
</div>

<!-- Prize Modal -->
<div id="prizeModal" class="modal hidden">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="prizeModalTitle">افزودن جایزه جدید</h3>
            <button class="modal-close" onclick="dashboard.closePrizeModal()">×</button>
        </div>
        <div class="modal-body">
            <form id="prizeForm">
                <input type="hidden" id="prizeId">

                <div class="form-group">
                    <label>نام جایزه (فارسی) *</label>
                    <input type="text" id="prizeName" required>
                </div>

                <div class="form-group">
                    <label>نام انگلیسی (برای UTM) *</label>
                    <input type="text" id="prizeEnglishName" required
                           pattern="[a-z0-9-]+"
                           title="فقط حروف کوچک انگلیسی، اعداد و خط تیره">
                    <small>مثال: iphone-15-pro یا gift-card-500k</small>
                </div>

                <div class="form-group">
                    <label>احتمال برد (0 تا 1) *</label>
                    <input type="number" id="prizeProbability" min="0" max="1" step="0.001" required>
                    <small>مثال: 0.05 معادل 5٪</small>
                </div>

                <div class="form-group">
                    <label>ترتیب نمایش *</label>
                    <input type="number" id="prizeDisplayOrder" min="1" required>
                </div>

                <div class="form-group">
                    <label>لینک جایزه</label>
                    <input type="url" id="prizeLink" placeholder="https://example.com">
                </div>

                <div class="form-group">
                    <label>لینک تصویر</label>
                    <input type="url" id="prizeImage" placeholder="https://example.com/image.jpg">
                </div>

                <div class="form-group">
                    <label>متن دکمه</label>
                    <input type="text" id="prizeButtonText" placeholder="دریافت جایزه">
                </div>

                <div class="form-group">
                    <label>توضیحات جایزه</label>
                    <textarea id="prizePrizeText" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>کد جایزه</label>
                    <input type="text" id="prizeCode" placeholder="GIFT2024">
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="prizeIsEmpty">
                        <span>جایزه پوچ (بدون جایزه)</span>
                    </label>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="prizeIsActive" checked>
                        <span>فعال</span>
                    </label>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="dashboard.closePrizeModal()">انصراف</button>
                    <button type="submit" class="btn-primary">ذخیره</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/admin/js/admin.js"></script>
</body>
</html>